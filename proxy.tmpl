package {{.PackageName}}

// Code generated by MikaÃ«l's proxy generator. DO NOT EDIT.

{{if .Imports}}import ({{range .Imports}}
	{{.}}{{end}}
){{end}}

{{$interfaceDeclaration := "interface { Package() string; Receiver() string; Name() string; Invoke(args []any) []any }"}}

type {{.ProxyName}} struct {
	delegate *{{.StructName}}
	invocationHandler   func(method {{$interfaceDeclaration}}, args []any) []any
}

type _{{.StructName}}Method struct {
	methodName string
    receiver string
    method func([]any) []any
}

func (m *_{{.StructName}}Method) Name() string { return m.methodName }

func (m *_{{.StructName}}Method) Receiver() string { return m.receiver }

func (m *_{{.StructName}}Method) Package() string { return "{{.PackageName}}" }

func (m *_{{.StructName}}Method) Invoke(args []any) []any { return m.method(args) }

{{range .Methods}}
func (d *{{$.ProxyName}}) {{.Name}}({{.Params}}) {{.Results}} {
	method := _{{$.StructName}}Method{
		methodName: "{{.Name}}",
	    receiver: "{{.Receiver}}",
	    method: func(args []any) []any {
            {{- if .Results}}{{range $index, $_ := .ResultTypes}}{{if $index}},{{end}}result{{$index}}{{end}} := {{end}}d.delegate.{{.Name}}({{.ParamNamesWithTypeAssertions}})
            return []any{ {{- if .Results}}{{range $index, $_ := .ResultTypes}}{{if $index}},{{end}}result{{$index}}{{end}}{{end}}}
        },
	};

	var args []any{{- if .Params}} = []any{ {{.ParamNames}} }{{end}};

	{{- if .Results}}results := d.invocationHandler(&method, args);
	return {{- range $index, $element := .ResultTypes}}{{if gt $index 0}}, {{end}} results[{{$index}}].({{$element}}){{end}}{{else}} d.invocationHandler(&method, args){{end}}}
{{end}}

func New{{.ProxyName}}(delegate *{{.StructName}}, invocationHandler func(method {{$interfaceDeclaration}}, args []any) (retVals []any)) *{{.ProxyName}} {
	if invocationHandler == nil {
		invocationHandler = func(method {{$interfaceDeclaration}}, args []any) []any {
			return method.Invoke(args)
		}
	}

	return &{{.ProxyName}}{
		delegate: delegate,
		invocationHandler:   invocationHandler,
	}
}
